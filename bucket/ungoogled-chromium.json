{
  "version": "142.0.7444.59-1.1",
  "description": "Ungoogled Chromium - Google Chromium without Google's integration",
  "homepage": "https://api.github.com/repos/ungoogled-software/ungoogled-chromium-windows/releases/latest",
  "license": "BSD-3-Clause",
  "url": "https://github.com/ungoogled-software/ungoogled-chromium-windows/releases/download/142.0.7444.59-1.1/ungoogled-chromium_142.0.7444.59-1.1_windows_x64.zip",
  "hash": "sha256:60e47a140bf406ace64586009445c23efb403b90282922462fdb8e65b2d34859",
  "depends": [
    "widevinecdm",
    "chromium-crlset"
  ],
  "bin": [
    [
      "chrome.exe",
      "chrome",
      "--user-data-dir=\"$dir\\User Data\" --disable-machine-id --disable-encryption --no-default-browser-check --profile-directory=\"Default\""
    ]
  ],
  "shortcuts": [
    [
      "chrome.exe",
      "Chromium",
      "--user-data-dir=\"$dir\\User Data\" --disable-machine-id --disable-encryption --no-default-browser-check --profile-directory=\"Default\""
    ]
  ],
  "extract_dir": "ungoogled-chromium_142.0.7444.59-1.1_windows_x64",
  "post_install": [
    "$componentPackage = @{",
    "  'WidevineCdm' = 'widevinecdm'",
    "  'CertificateRevocation' = 'chromium-crlset'",
    "}",
    "Write-Host 'Linking DRM and security components (WidevineCdm, CRLSet)...'",
    "$componentPackage.GetEnumerator() | ForEach-Object {",
    "  $pkgName = $_.Value",
    "  $componentDir = $_.Key",
    "  $pkgCurrentDir = $(versiondir $pkgName 'current' $global)",
    "  if ($pkgCurrentDir) {",
    "    $sourceComponentPath = Join-Path $pkgCurrentDir $componentDir",
    "    if (Test-Path $sourceComponentPath) {",
    "      New-Item -Path (Join-Path $dir $componentDir) -Target $sourceComponentPath -ItemType Junction -Force | Out-Null",
    "      Write-Host (\"Linked {0} from package '{1}'.\" -f $componentDir, $pkgName)",
    "      # Try to detect installing bucket (best effort)",
    "      $bucketDetected = $null",
    "      $installJsonPath = Join-Path $pkgCurrentDir 'install.json'",
    "      $manifestJsonPath = Join-Path $pkgCurrentDir 'manifest.json'",
    "      foreach ($infoPath in @($installJsonPath, $manifestJsonPath)) {",
    "        if (-not $bucketDetected -and (Test-Path $infoPath)) {",
    "          try {",
    "            $info = Get-Content $infoPath -Raw | ConvertFrom-Json",
    "            if ($info.bucket) { $bucketDetected = $info.bucket }",
    "            elseif ($info.SourceBucket) { $bucketDetected = $info.SourceBucket }",
    "          } catch {}",
    "        }",
    "      }",
    "      if ($bucketDetected -and $bucketDetected -ne 'scoop-alts') {",
    "        Write-Host (\"Note: dependency '{0}' appears to be installed from bucket '{1}'. Components from other buckets may differ.\" -f $pkgName, $bucketDetected) -ForegroundColor Yellow",
    "        Write-Host \"Tip: To use scoop-alts components, run: scoop bucket add scoop-alts https://github.com/danalec/scoop-alts\" -ForegroundColor Yellow",
    "      }",
    "    } else {",
    "      Write-Host (\"Note: component directory '{0}' not found in package '{1}'. Try updating or reinstalling that package.\" -f $componentDir, $pkgName) -ForegroundColor Yellow",
    "    }",
    "  } else {",
    "    Write-Host (\"Note: dependency '{0}' was not found. Install with 'scoop install {0}' to enable DRM/revocation features.\" -f $pkgName) -ForegroundColor Yellow",
    "  }",
    "}",
    "Write-Host 'Component linking complete. Restart Chromium to apply changes.' -ForegroundColor Green",
    "$shouldRun = $false",
    "if ($env:SCOOP_SET_DEFAULT_BROWSER -eq '1') { $shouldRun = $true }",
    "elseif ($env:SCOOP_INTERACTIVE -eq '1') {",
    "  $ans = Read-Host 'Do you want to register Ungoogled Chromium as a browser (non-invasive)? (y/n)'",
    "  if ($ans -match '^(y|Y)$') { $shouldRun = $true }",
    "}",
    "if ($shouldRun) {",
    "  Write-Host 'Registering Ungoogled Chromium capabilities...'",
    "  $chromePath = \"$dir\\chrome.exe\"",
    "  $chromiumUserDataDir = \"$dir\\User Data\"",
    "  $chromeArgs = ('--user-data-dir=\"{0}\" --disable-machine-id --disable-encryption --no-default-browser-check --profile-directory=\"Default\"' -f $chromiumUserDataDir)",
    "  $progId = 'ChromiumHTML'",
    "  # Register our own ProgID only",
    "  New-Item -Path \"HKCU:\\Software\\Classes\\$progId\" -Force | Out-Null",
    "  Set-ItemProperty -Path \"HKCU:\\Software\\Classes\\$progId\" -Name '(Default)' -Value 'Chromium HTML Document' -ErrorAction SilentlyContinue",
    "  New-Item -Path \"HKCU:\\Software\\Classes\\$progId\\shell\\open\\command\" -Force | Out-Null",
    "  Set-ItemProperty -Path \"HKCU:\\Software\\Classes\\$progId\\shell\\open\\command\" -Name '(Default)' -Value ('\"{0}\" {1} -- \"%1\"' -f $chromePath, $chromeArgs) -ErrorAction SilentlyContinue",
    "  # StartMenuInternet registration + Capabilities",
    "  $chromiumAppRoot = 'HKCU:\\Software\\Clients\\StartMenuInternet\\Chromium'",
    "  New-Item -Path $chromiumAppRoot -Force | Out-Null",
    "  Set-ItemProperty -Path $chromiumAppRoot -Name '(Default)' -Value 'Ungoogled Chromium' -ErrorAction SilentlyContinue",
    "  $chromiumAppCmd = Join-Path $chromiumAppRoot 'shell\\open\\command'",
    "  New-Item -Path $chromiumAppCmd -Force | Out-Null",
    "  Set-ItemProperty -Path $chromiumAppCmd -Name '(Default)' -Value ('\"{0}\" {1}' -f $chromePath, $chromeArgs) -ErrorAction SilentlyContinue",
    "  $capabilitiesPath = Join-Path $chromiumAppRoot 'Capabilities'",
    "  New-Item -Path $capabilitiesPath -Force | Out-Null",
    "  Set-ItemProperty -Path $capabilitiesPath -Name 'ApplicationName' -Value 'Ungoogled Chromium' -ErrorAction SilentlyContinue",
    "  Set-ItemProperty -Path $capabilitiesPath -Name 'ApplicationDescription' -Value 'Ungoogled Chromium Browser' -ErrorAction SilentlyContinue",
    "  $urlAssocPath = Join-Path $capabilitiesPath 'URLAssociations'",
    "  New-Item -Path $urlAssocPath -Force | Out-Null",
    "  Set-ItemProperty -Path $urlAssocPath -Name 'http' -Value $progId -ErrorAction SilentlyContinue",
    "  Set-ItemProperty -Path $urlAssocPath -Name 'https' -Value $progId -ErrorAction SilentlyContinue",
    "  Set-ItemProperty -Path 'HKCU:\\Software\\RegisteredApplications' -Name 'Chromium' -Value 'Software\\Clients\\StartMenuInternet\\Chromium\\Capabilities' -ErrorAction SilentlyContinue",
    "  # Optional: override http/https open commands only if explicitly allowed via env",
    "  if ($env:SCOOP_OVERRIDE_DEFAULT_COMMAND -eq '1') {",
    "    Write-Host 'Overriding http/https handlers (opt-in) and backing up previous values...' -ForegroundColor Yellow",
    "    $backupFile = Join-Path $dir 'default-association-backup.json'",
    "    $backup = @{}",
    "    foreach ($scheme in @('http','https')) {",
    "      $key = \"HKCU:\\Software\\Classes\\$scheme\\shell\\open\\command\"",
    "      if (Test-Path $key) {",
    "        try { $cur = (Get-ItemProperty -Path $key -Name '(Default)').'(Default)'; $backup[$scheme] = $cur } catch {}",
    "      }",
    "      New-Item -Path $key -Force | Out-Null",
    "      Set-ItemProperty -Path $key -Name '(Default)' -Value ('\"{0}\" {1} -- \"%1\"' -f $chromePath, $chromeArgs) -ErrorAction SilentlyContinue",
    "    }",
    "    $backup | ConvertTo-Json | Set-Content -Path $backupFile -Encoding UTF8",
    "  }",
    "  Write-Host 'Opening Default Apps settings so you can confirm associations...' -ForegroundColor Yellow",
    "  try { Start-Process 'ms-settings:defaultapps' } catch { Write-Host 'Could not open Default Apps settings automatically.' -ForegroundColor Yellow }",
    "} else {",
    "  Write-Host 'Skipping browser registration. To run automatically, set SCOOP_SET_DEFAULT_BROWSER=1 or export SCOOP_INTERACTIVE=1 for a prompt.'",
    "}"
  ],
  "uninstaller": {
    "script": [
      "Write-Host 'ðŸ”§ Ungoogled Chromium uninstall cleanup starting...' -ForegroundColor Cyan",
      "function Confirm-Action($Message) {",
      "  $ans = Read-Host \"$Message (y/n)\"",
      "  return ($ans -match '^(y|Y)$')",
      "}",
      "$removed = @()",
      "# 1) Remove StartMenuInternet registration (Chromium)",
      "$startMenuKey = 'HKCU:\\Software\\Clients\\StartMenuInternet\\Chromium'",
      "if (Test-Path $startMenuKey) {",
      "  Write-Host 'Found StartMenuInternet registration at:' $startMenuKey -ForegroundColor Yellow",
      "  if (Confirm-Action 'Remove this registration?') {",
      "    try { Remove-Item -Path $startMenuKey -Recurse -Force -ErrorAction Stop; $removed += $startMenuKey } catch { Write-Host \"Failed: $_\" -ForegroundColor Red }",
      "  } else { Write-Host 'Skipped removing StartMenuInternet registration.' -ForegroundColor Cyan }",
      "}",
      "# 2) Remove ChromiumHTML ProgID class",
      "$progIdKey = 'HKCU:\\Software\\Classes\\ChromiumHTML'",
      "if (Test-Path $progIdKey) {",
      "  $cmdPath = Join-Path $progIdKey 'shell\\open\\command'",
      "  $currentCmd = $null; if (Test-Path $cmdPath) { try { $currentCmd = (Get-ItemProperty -Path $cmdPath -ErrorAction SilentlyContinue).'(Default)' } catch {} }",
      "  if ($currentCmd) { Write-Host (\"Current open command: {0}\" -f $currentCmd) -ForegroundColor Yellow }",
      "  if (Confirm-Action 'Remove ChromiumHTML class (file association ProgID)?') {",
      "    try { Remove-Item -Path $progIdKey -Recurse -Force -ErrorAction Stop; $removed += $progIdKey } catch { Write-Host \"Failed: $_\" -ForegroundColor Red }",
      "  } else { Write-Host 'Skipped removing ChromiumHTML class.' -ForegroundColor Cyan }",
      "}",
      "# 3) Remove RegisteredApplications entry",
      "$registeredAppsPath = 'HKCU:\\Software\\RegisteredApplications'",
      "try { $regApps = Get-ItemProperty -Path $registeredAppsPath -ErrorAction SilentlyContinue } catch {}",
      "if ($regApps -and ($regApps.PSObject.Properties.Name -contains 'Chromium')) {",
      "  Write-Host 'Found RegisteredApplications value: Chromium' -ForegroundColor Yellow",
      "  if (Confirm-Action 'Remove RegisteredApplications value for Chromium?') {",
      "    try { Remove-ItemProperty -Path $registeredAppsPath -Name 'Chromium' -ErrorAction Stop; $removed += ($registeredAppsPath + '::Chromium') } catch { Write-Host \"Failed: $_\" -ForegroundColor Red }",
      "  } else { Write-Host 'Skipped removing RegisteredApplications value.' -ForegroundColor Cyan }",
      "}",
      "# 4) Optionally clear http/https shell open command overrides if they point to Scoop path",
      "$httpCmdPath = 'HKCU:\\Software\\Classes\\http\\shell\\open\\command'",
      "$httpsCmdPath = 'HKCU:\\Software\\Classes\\https\\shell\\open\\command'",
      "foreach ($p in @($httpCmdPath, $httpsCmdPath)) {",
      "  if (Test-Path $p) {",
      "    $val = $null; try { $val = (Get-ItemProperty -Path $p -ErrorAction SilentlyContinue).'(Default)' } catch {}",
      "    if ($val -and ($val -like '*\\scoop\\apps\\ungoogled-chromium*')) {",
      "      Write-Host (\"Found override at {0}: {1}\" -f $p, $val) -ForegroundColor Yellow",
      "      if (Confirm-Action ('Remove this override?')) {",
      "        try { Remove-Item -Path $p -Recurse -Force -ErrorAction Stop; $removed += $p } catch { Write-Host \"Failed: $_\" -ForegroundColor Red }",
      "      } else { Write-Host 'Skipped removing override.' -ForegroundColor Cyan }",
      "    }",
      "  }",
      "}",
      "# 0) Restore http/https open command from backup if present",
      "$backupFile = Join-Path $dir 'default-association-backup.json'",
      "if (Test-Path $backupFile) {",
      "  try {",
      "    $backup = Get-Content -Path $backupFile -Raw | ConvertFrom-Json",
      "    foreach ($scheme in @('http','https')) {",
      "      $val = $backup.$scheme",
      "      if ($null -ne $val) {",
      "        if (Confirm-Action (\"Restore $scheme open command to saved value?\")) {",
      "          $key = \"HKCU:\\Software\\Classes\\$scheme\\shell\\open\\command\"",
      "          New-Item -Path $key -Force | Out-Null",
      "          Set-ItemProperty -Path $key -Name '(Default)' -Value $val",
      "          Write-Host (\"Restored $scheme open command.\") -ForegroundColor Green",
      "        }",
      "      }",
      "    }",
      "  } catch { Write-Host 'Backup restore failed; continuing cleanup.' -ForegroundColor Yellow }",
      "}",
      "Write-Host 'Cleanup complete.' -ForegroundColor Green",
      "if ($removed.Count -gt 0) {",
      "  Write-Host 'Removed the following entries:' -ForegroundColor Green",
      "  $removed | ForEach-Object { Write-Host (' - {0}' -f $_) }",
      "} else {",
      "  Write-Host 'No matching registry entries were removed.' -ForegroundColor Cyan",
      "}",
      "if (Confirm-Action 'Open Default Apps settings to verify associations now?') {",
      "  try { Start-Process 'ms-settings:defaultapps' } catch { Write-Host 'Could not open Default Apps settings automatically.' -ForegroundColor Yellow }",
      "}",
      "Write-Host 'Note: Your profile data in Scoop persist is not removed by default. To remove it completely, run:' -ForegroundColor Yellow",
      "Write-Host '  scoop uninstall ungoogled-chromium --purge' -ForegroundColor Yellow"
    ]
  },
  "persist": "User Data",
  "checkver": {
    "url": "https://api.github.com/repos/ungoogled-software/ungoogled-chromium-windows/releases/latest",
    "regex": "\"tag_name\":\\s*\"([0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+-[0-9]+\\.[0-9]+)\""
  },
  "autoupdate": {
    "extract_dir": "ungoogled-chromium_$version_windows_x64",
    "url": "https://github.com/ungoogled-software/ungoogled-chromium-windows/releases/download/$version/ungoogled-chromium_$version_windows_x64.zip"
  }
}